# uniapp.test CLI 命令行工具文档

插件市场 [HBuilderX uni-app自动化测试](https://ext.dcloud.net.cn/plugin?id=5708)插件 4.1.0版本起，支持被HBuilderX CLI调用了。

支持在命令行运行 uni-app (x) 自动化测试到 Web、微信小程序、Android、iOS 和 Harmony。

关于HBuilderX cli命令基本介绍，请参考：[https://hx.dcloud.net.cn/cli/README](https://hx.dcloud.net.cn/cli/README)

> 特别注意事项：运行HBuilderX `cli uniapp.test`前，请先确保[HBuilderX uni-app自动化测试](https://ext.dcloud.net.cn/plugin?id=5708)插件可以在HBuilderX内正常使用。

## 插件安装

[插件安装地址](https://ext.dcloud.net.cn/plugin?id=5708) 在插件市场，点击【导入插件】，会自动拉起本地安装的HBuilderX。

<img src="https://web-ext-storage.dcloud.net.cn/doc/uni-test/plugins_install_1.jpeg" style="zoom: 50%;border: 1px solid #eee;border-radius: 5px;"/>

## cli使用方法

> 注意事项：
>   1. 使用CLI需要进入HBuilderX安装目录；
>   2. 在windows电脑，HBuilderX安装目录下调用cli命令要输入完整，具体为.\cli.exe

以下是该工具的基本用法：

```
// 查看帮助
cli uniapp.test --help

// 基本使用方法
cli uniapp.test <platform> --project <ProjectPath>

// windows电脑基本使用方法
.\cli.exe uniapp.test <platform> --project <ProjectPath>
```

### 支持的平台

- **Web**
  - `web-chrome`：在 Chrome 浏览器中运行测试
  - `web-safari`：在 Safari 浏览器中运行测试
  - `web-firefox`：在 Firefox 浏览器中运行测试

- **小程序**
  - `mp-weixin`：在微信小程序中运行测试

- **移动应用**
  - `app-android`：在 Android 设备上运行测试
  - `app-ios-simulator`：在 iOS 模拟器中运行测试
  - `app-harmony`：在 Harmony 设备上运行测试

### 参数说明

- **必需参数**
  - `--project <ProjectPath>`：指定项目的路径。

- **可选参数**
  - `--testcaseFile <testcase_file_path>`：指定测试用例文件的路径（仅适用于 `app-harmony`）。
  - `--device_id <id>`：指定设备 ID（仅适用于 `app-harmony`）。
  - `--help`：显示命令帮助信息。
  - `--version`：查看插件版本号。

## uni-app 自动化测试依赖说明

如果您没有安装自动化测试依赖，调用HBuilderX CLI测试时，会出现如下提示，请根据提示语进行操作。

注意：playwright，依赖包体积很大（约1G左右），安装受限于网络、操作系统等环境，可能安装较慢。

如果playwright安装遇到问题，请参考: [https://playwright.dev/docs/intro](https://playwright.dev/docs/intro)

<img src="https://web-ext-storage.dcloud.net.cn/doc/uni-test/uniapp_test_lib.jpg" style="zoom: 50%;border: 1px solid #eee;border-radius: 5px;"/>

## 示例

> 注意事项：请先在终端切换到HBuilderX安装目录，再运行以下命令。

1. 运行测试到chrome

```bash
// Mac电脑
/Applications/HBuilderX.app/Contents/MacOS/cli uniapp.test web-chrome --project /path/to/your/project

// windows电脑
D:\ide\HBuilderX\cli.exe uniapp.test web-chrome --project /path/to/your/project
```

2. 运行测试到微信开发者工具

```bash
cli uniapp.test mp-weixin --project /path/to/your/project
```

3. 运行测试到Android

```bash
cli uniapp.test app-android --project /path/to/your/project
```
   
4. 指定设备ID

```bash
cli uniapp.test app-android --project /path/to/your/project --device_id feyh2342343uos8ai89jr4p
```
   
5. 运行特定的测试用例文件

```bash
cli uniapp.test app-android --project /path/to/your/project --testcaseFile pages/index/index.test.js
```

## 通过npm scripts使用CLI@npm

我们需要在项目中安装 [@dcloudio/hbuilderx-cli](https://www.npmjs.com/package/@dcloudio/hbuilderx-cli),它是一个桥梁，让我们可以通过命令行来调用 HBuilderX 的强大功能（如启动测试流程）。

#### 添加 npm 脚本支持

```shell
# 首先，请确保你的项目根目录下有 package.json 文件。如果没有，可以通过以下命令快速生成：
npm init -y

# 然后，安装 hbuilderx-cli 作为开发依赖：
npm install @dcloudio/hbuilderx-cli --save-dev
```

#### 使用npm命令查看日志

```shell
# 在 Chrome 中测试
npm run test:web -- --browser Chrome

# 在 Safari 中测试
npm run test:web -- --browser Safari

# 在连接的 Android 设备上测试 (默认会使用第一个android设备进行测试)
npm run test:app-android

# 在 iOS 模拟器上测试 (默认会使用第一个iOS模拟器设备进行测试)
npm run test:app-ios

# 在连接的 Harmony 设备上测试 (默认会使用第一个Harmony设备进行测试)
npm run test:app-harmony

# 在指定的 Android 设备上测试 (需替换为你的设备ID)
npm run test:app-android -- --udid your_device_id
```